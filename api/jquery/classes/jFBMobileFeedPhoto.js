/*!
 * jFBMobileFeedPhoto.js
 *
 * @version  1.0.2
 * @author   Yusuke Sugomori
 * @license  http://yusugomori.com/license/mit The MIT License
 *
 * More details on github: https://github.com/yusugomori/jFBMobileFeedPhoto
*/
var jFBMobileFeedPhoto;jFBMobileFeedPhoto=(function(){function a(b){if(b==null){b={}}this.scrollTop=0;this.placeHolderId="#jFBMobileFeedPhoto";this.margin=20;this.imageMargin=7;this.images=[];if(b.id!=null){this.placeHolderId=b.id}this.$placeHolder=$(this.placeHolderId);this.overlayPlaceHolderId=this.placeHolderId+"Overlay";this.overlayImageMargin=20;this.overlayCloseText="Done";this.overlayCloseTextPos=15;this.isOverlayShown=false;this.isOriented=false;this.onTouchThres=10;this.onTouchCurrent={x:0,y:0};this.onTouchStart={x:0,y:0};this.onTouchDrag={x:0,y:0};this.onTouchImageFlg=false;this.currentImgNum=null;this.targetImg=null;this.onTouchCurrentOverlay={x:0,y:0};this.onTouchStartOverlay={x:0,y:0};this.onTouchDragOverlay={x:0,y:0};this.currentImgNumOverlay=null;$("body").append('<div id="'+(this.overlayPlaceHolderId.substring(1))+'"></div>');this.$overlayPlaceHolder=$(this.overlayPlaceHolderId);this.$placeHolder.hide();this.$overlayPlaceHolder.hide();this.setImageArray();this.$placeHolder.empty();if(b.margin!=null){this.margin=b.margin}if(!((b.margin!=null)||this.images.length!==1)){this.margin=5}this.winWidth=$(window).width();this.winHeight=0;this.placeImage();this.placeOverlay();this.setStaticCss();this.setStaticOverlayCss();this.main();this.orientationchange()}a.prototype.main=function(){this.setCss();this.$placeHolder.show();if(this.images.length>1){this.onTouch(true)}else{this.onTouch(false)}};a.prototype.onTouch=function(b){if(b==null){b=true}this.touchstart();this.touchmove(b);this.touchend(b)};a.prototype.touchstart=function(){var b=this;this.$placeHolder.on("touchstart",function(c){var d;if(event.touches[1]!=null){c.preventDefault();return}b.targetImg=c.target;d=event.touches[0];b.onTouchCurrent=b.getTranslate(b.$placeHolder);b.onTouchStart={x:d.pageX,y:d.pageY};b.onTouchDrag={x:d.pageX,y:d.pageY};if((b.targetImg.tagName!=null)&&b.targetImg.tagName.toLowerCase().match(/img/)){return b.onTouchImageFlg=true}})};a.prototype.touchmove=function(b){var c=this;if(b==null){b=true}this.$placeHolder.on("touchmove",function(g){var h,f,d;if(event.touches[1]!=null){g.preventDefault();return}h=event.touches[0];c.onTouchDrag={x:h.pageX,y:h.pageY};if(!b){return}f=Math.abs(c.onTouchStart.x-c.onTouchDrag.x);d=Math.abs(c.onTouchStart.y-c.onTouchDrag.y);if(f>=d){g.preventDefault();return c.slideImage()}})};a.prototype.touchend=function(b){var c=this;if(b==null){b=true}this.$placeHolder.on("touchend",function(g){var f,d;if(event.touches[1]!=null){g.preventDefault();return}if(c.onTouchImageFlg){c.onTouchImageFlg=false;f=Math.abs(c.onTouchStart.x-c.onTouchDrag.x);d=Math.abs(c.onTouchStart.y-c.onTouchDrag.y);if(f<c.onTouchThres&&d<c.onTouchThres){c.showOverlay();return}}if(!b){return}return c.slideImageFix()})};a.prototype.onTouchOverlay=function(b){if(b==null){b=true}this.touchstartOverlay();this.touchmoveOverlay(b);this.touchendOverlay(b)};a.prototype.touchstartOverlay=function(){var b=this;this.$overlayPlaceHolder.on("touchstart",function(c){var d;if(event.touches[1]!=null){c.preventDefault();return}d=event.touches[0];b.onTouchCurrentOverlay=b.getTranslate(b.$overlayPlaceHolder.children().eq(0));b.onTouchStartOverlay={x:d.pageX,y:d.pageY};return b.onTouchDragOverlay={x:d.pageX,y:d.pageY}})};a.prototype.touchmoveOverlay=function(b){var c=this;if(b==null){b=true}this.$overlayPlaceHolder.on("touchmove",function(d){var f;d.preventDefault();if(event.touches[1]!=null){return}f=event.touches[0];c.onTouchDragOverlay={x:f.pageX,y:f.pageY};if(!b){return}return c.slideImageOverlay()})};a.prototype.touchendOverlay=function(b){var c=this;if(b==null){b=true}this.$overlayPlaceHolder.on("touchend",function(d){if(event.touches[1]!=null){d.preventDefault();return}if(!b){return}return c.slideImageFixOverlay()})};a.prototype.showOverlay=function(){var b=this;this.setScrollTop();this.$overlayPlaceHolder.css({visibility:"hidden"});this.$overlayPlaceHolder.show();this.setOverlayCss();$("html,body").height(this.winHeight);this.$overlayPlaceHolder.css({visibility:"visible"});this.isOverlayShown=true;if(this.images.length>1){this.onTouchOverlay(true)}else{this.onTouchOverlay(false)}this.$overlayPlaceHolder.children().eq(1).on("click",function(c){return b.hideOverlay()});$(window).on("scroll",function(c){if(!b.isOriented){b.hideOverlay()}return b.isOriented=false})};a.prototype.hideOverlay=function(){$("html,body").css({height:"auto"});this.$overlayPlaceHolder.off("touchstart");this.$overlayPlaceHolder.off("touchmove");this.$overlayPlaceHolder.off("touchend");this.$overlayPlaceHolder.children().eq(1).off("click");this.$overlayPlaceHolder.hide();this.isOverlayShown=false;$(window).off("scroll");scrollTo(0,this.scrollTop)};a.prototype.slideImage=function(){var d,c,b;d=this.onTouchDrag.x-this.onTouchStart.x;b=this.onTouchCurrent.x+d;c=this.winWidth-2*this.margin;if(b>0){b=0}if(b<-1*(this.images.length-1)*(c+this.imageMargin)){b=-1*(this.images.length-1)*(c+this.imageMargin)}this.$placeHolder.css({"-webkit-transition-duration":"0ms","-webkit-transform":"translate3d("+b+"px, 0px, 0px)"})};a.prototype.slideImageFix=function(d){var e,f,c,b;if(d==null){d=false}c=this.winWidth-2*this.margin;if(d&&(this.currentImgNum!=null)){f=this.currentImgNum}else{e=this.onTouchDrag.x-this.onTouchStart.x;b=this.onTouchCurrent.x+e;f=Math.abs(b-c/2-this.imageMargin)}if(f<0){b=0;this.currentImgNum=0}else{if(!(d&&(this.currentImgNum!=null))){f=parseInt(f/(c+this.imageMargin))}if(f>=this.images.length){b=-1*(this.images.length-1)*(c+this.imageMargin)}else{b=-1*f*(c+this.imageMargin)}this.currentImgNum=f}this.$placeHolder.css({"-webkit-transition-duration":"150ms","-webkit-transform":"translate3d("+b+"px, 0px, 0px)"})};a.prototype.slideImageOverlay=function(){var c,b;c=this.onTouchDragOverlay.x-this.onTouchStartOverlay.x;b=this.onTouchCurrentOverlay.x+c;if(b>0){b=0}if(b<-1*(this.images.length-1)*(this.winWidth+this.overlayImageMargin)){b=-1*(this.images.length-1)*(this.winWidth+this.overlayImageMargin)}this.$overlayPlaceHolder.children().eq(0).css({"-webkit-transform":"translate3d("+b+"px, 0px, 0px)"})};a.prototype.slideImageFixOverlay=function(d){var e,g,f,c,b;if(d==null){d=false}c=this.winWidth;if(d&&(this.currentImgNumOverlay!=null)){f=this.currentImgNumOverlay}else{e=this.onTouchDragOverlay.x-this.onTouchStartOverlay.x;b=this.onTouchCurrentOverlay.x+e;f=Math.abs(b-c/2-this.overlayImageMargin)}if(f<0){b=0;this.currentImgNumOverlay=0}else{if(!(d&&(this.currentImgNumOverlay!=null))){f=parseInt(f/(c+this.overlayImageMargin))}if(f>=this.images.length){b=-1*(this.images.length-1)*(c+this.overlayImageMargin)}else{b=-1*f*(c+this.overlayImageMargin)}this.currentImgNumOverlay=f}if(d){g="0ms"}else{if(this.winWidth>this.winHeight){g="300ms"}else{g="150ms"}}this.$overlayPlaceHolder.children().eq(0).css({"-webkit-transition-duration":g,"-webkit-transform":"translate3d("+b+"px, 0px, 0px)"})};a.prototype.setStaticCss=function(){$("html, body").css({overflow:"hidden",height:"auto"});this.$placeHolder.css({position:"relative",margin:"0 auto","-webkit-transform":"translate3d(0px, 0px, 0px)","-webkit-transition-property":"-webkit-transform","-webkit-transform-style":"preserve-3d","-webkit-transition-timing-function":"ease-in-out","-webkit-transition-duration":"0ms"});this.$placeHolder.children().css({position:"absolute",top:0});this.$placeHolder.children().children().css({position:"relative",overflow:"hidden","-webkit-box-shadow":"0 1px 2px #888","box-shadow":"0 1px 2px #888"});this.$placeHolder.children().children().find("img").css({"max-width":"100%",height:"auto",border:0,display:"block",position:"absolute",top:0,left:0})};a.prototype.setStaticOverlayCss=function(){this.$overlayPlaceHolder.css({overflow:"hidden","z-index":9999,position:"fixed",top:0,left:0,background:"#000"});this.$overlayPlaceHolder.children().eq(0).css({"-webkit-transform":"translate3d(0px, 0px, 0px)","-webkit-transition-property":"-webkit-transform","-webkit-transform-style":"preserve-3d","-webkit-transition-timing-function":"ease-in-out","-webkit-transition-duration":"0ms"});this.$overlayPlaceHolder.children().eq(1).css({"z-index":10000,position:"absolute",top:this.overlayCloseTextPos,right:this.overlayCloseTextPos,background:"rgba(0,0,0,0.5)",color:"#ddd",padding:"3px 10px",border:"solid 2px #ddd","border-radius":"3px","font-size":"11px","font-weight":"bold"});this.$overlayPlaceHolder.children().eq(0).children().css({position:"absolute",top:0});this.$overlayPlaceHolder.children().eq(0).children().children().css({position:"relative",overflow:"hidden"});this.$overlayPlaceHolder.children().eq(0).children().children().find("img").css({border:0,display:"block",position:"absolute"});this.$overlayPlaceHolder.children().eq(0).children().children().children("div").css({position:"absolute",bottom:0,left:0,color:"#fff",background:"rgba(0,0,0,0.3)",padding:"20px","font-size":"14px","letter-spacing":"1px","-webkit-box-sizing":"border-box","box-sizing":"border-box"})};a.prototype.setCss=function(){var g,c,d,h,b,e,f;this.setWinHeight();h=0;b=this.winWidth-2*this.margin;g=b;d=this.$placeHolder.parent().width();if(d<b){h=(d-b)/2}this.$placeHolder.css({height:b,width:b,left:h});for(c=0,f=this.images.length;0<=f?c<f:c>f;0<=f?c++:c--){e=c*(b+this.imageMargin);this.$placeHolder.children().eq(c).css({left:e})}this.$placeHolder.children().children().css({height:g,width:b});this.$placeHolder.children().children().find("img").css({"min-width":b,"min-height":b})};a.prototype.setOverlayCss=function(){var j,b,k,n,h,f,l,d,q,g,c,p,o,m,e;b=$(this.targetImg).attr("data-image-number");k=-1*b*(this.winWidth+this.overlayImageMargin);this.setWinHeight();this.$overlayPlaceHolder.css({height:this.winHeight+5,width:this.winWidth});this.$overlayPlaceHolder.children().eq(0).css({"-webkit-transform":"translate3d("+k+"px, 0px, 0px)"});for(j=0,g=this.images.length;0<=g?j<g:j>g;0<=g?j++:j--){q=j*(this.winWidth+this.overlayImageMargin);this.$overlayPlaceHolder.children().eq(0).children().eq(j).css({left:q});l=this.$overlayPlaceHolder.children().eq(0).children().eq(j).children().find("img");n=$(l);c=n.attr("src");o=new Image();o.src=c;m=o.width;h=o.height;e=m;f=h;if(m>this.winWidth){e=this.winWidth;h=h*this.winWidth/m;f=h}if(h>this.winHeight){f=this.winHeight;e=e*this.winHeight/h}p=(this.winHeight-f)/2;d=(this.winWidth-e)/2;n.css({top:p,left:d,height:f,width:e})}this.$overlayPlaceHolder.children().eq(0).children().children().css({height:this.winHeight,width:this.winWidth});this.$overlayPlaceHolder.children().eq(0).children().children().children("div").css({width:this.winWidth})};a.prototype.placeImage=function(){var c,b,d;for(c=0,d=this.images.length;0<=d?c<d:c>d;0<=d?c++:c--){b="<div><div>";b+='<img src="'+this.images[c].img+'" data-image-number="'+c+'" />';b+="</div></div>";this.$placeHolder.append(b)}};a.prototype.placeOverlay=function(){var c,b,d;this.$overlayPlaceHolder.append("<div></div>");this.$overlayPlaceHolder.append("<div>"+this.overlayCloseText+"</div>");for(c=0,d=this.images.length;0<=d?c<d:c>d;0<=d?c++:c--){b="<div><div>";b+='<img src="'+this.images[c].img+'" data-image-number="'+c+'" />';if(this.images[c].div!=null){b+="<div>"+this.images[c].div+"</div>"}b+="</div></div>";this.$overlayPlaceHolder.children().eq(0).append(b)}};a.prototype.setImageArray=function(){var b;b=this;this.$placeHolder.children("div").each(function(){var d,e,c;e=$(this).children("img");d=$(this).children("div");c={img:e.attr("src")};if(d.length>0){c.div=d.html()}return b.images.push(c)})};a.prototype.getTranslate=function(c){var b;b=new WebKitCSSMatrix($(c).css("-webkit-transform"));return{x:parseInt(b.e,10),y:parseInt(b.f,10)}};a.prototype.setWinHeight=function(){if(window.innerHeight!=null){this.winHeight=window.innerHeight}else{this.winHeight=$(window).height()}};a.prototype.setScrollTop=function(){this.scrollTop=$(window).scrollTop()};a.prototype.iphoneHack=function(){setTimeout(scrollTo,120,0,1)};a.prototype.orientationchange=function(){var b=this;$(window).on("orientationchange",function(){b.$placeHolder.hide();b.winWidth=$(window).width();b.slideImageFix(true);b.main();if(b.isOverlayShown){b.isOriented=true;b.setOverlayCss();return b.slideImageFixOverlay(true)}})};return a})();
